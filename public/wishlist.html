<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sản phẩm yêu thích | linhkien4u</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        #cart-count {
            position: absolute; top: -8px; right: -10px; background-color: red; color: white;
            border-radius: 50%; padding: 0px 6px; font-size: 12px; font-weight: bold;
            border: 2px solid #111827; display: none;
        }
        .group:hover .group-hover\:block { display: block; }
    </style>
    <script>
        const loggedInUserForWishlist = JSON.parse(localStorage.getItem('loggedInUser'));
        if (!loggedInUserForWishlist) {
            alert('Vui lòng đăng nhập để xem danh sách yêu thích!');
            window.location.href = 'login.html';
        }
    </script>
</head>
<body class="bg-gray-100">

    <header class="bg-gray-900 text-white sticky top-0 z-50 shadow-md">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <a href="index.html" class="text-2xl font-bold">linhkien4u</a>
            <nav class="flex items-center gap-4 text-sm">
                <a href="index.html" class="hover:text-yellow-400 transition py-2">Trang chủ</a>
                <a href="product.html" class="hover:text-yellow-400 transition py-2">Sản phẩm</a>
                <a href="cart.html" class="relative hover:text-yellow-400 transition flex items-center py-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                    <span id="cart-count">0</span>
                </a>
                 <div id="auth-section" class="flex items-center gap-4"></div>
            </nav>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-gray-800">Sản phẩm yêu thích</h1>
            <p class="text-gray-500 mt-2">Những linh kiện bạn đã quan tâm.</p>
        </div>
        
        <div id="wishlist-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- JS sẽ điền sản phẩm yêu thích vào đây -->
        </div>

        <div id="no-items-message" class="hidden text-center py-16 bg-white rounded-lg shadow-sm">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
            <h3 class="mt-2 text-xl font-medium text-gray-900">Danh sách trống</h3>
            <p class="mt-1 text-sm text-gray-500">Bạn chưa có sản phẩm yêu thích nào.</p>
            <div class="mt-6">
              <a href="product.html" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">
                Khám phá sản phẩm
              </a>
            </div>
        </div>
    </main>
    
    <footer class="bg-gray-900 text-white py-6 text-center mt-16">
        <p class="text-sm">© 2025 linhkien4u. All rights reserved.</p>
    </footer>

    <script>
        // --- DỮ LIỆU SẢN PHẨM (NHÚNG TRỰC TIẾP) ---
        const productCatalog = [ { mainCategoryTitle: "LINH KIỆN BÁN DẪN", subCategories: [ { type: "transistor-bjt", title: "Transistor BJT", products: [ { id: "a1013", name: "A1013", stock: 150, priceTiers: [{ range: "1+", price: "1.000đ" }], img: "./images/Product/LINH KIỆN BÁN DẪN/Transistor BJT/A1013.jpg" }, { id: "d718", name: "D718", stock: 120, priceTiers: [{ range: "1+", price: "9.000đ" }], img: "./images/Product/LINH KIỆN BÁN DẪN/Transistor BJT/D718.jpg" }, { id: "b688", name: "B688", stock: 0, priceTiers: [{ range: "1+", price: "9.000đ" }], img: "./images/Product/LINH KIỆN BÁN DẪN/Transistor BJT/B688.jpg" }, { id: "c5200", name: "2SC5200 (C5200)", stock: 50, priceTiers: [{ range: "1+", price: "30.000đ" }], img: "./images/Product/LINH KIỆN BÁN DẪN/Transistor BJT/2SC5200 (C5200).jpg" } ] }, { type: "mosfet", title: "MOSFET", products: [ { id: "IRF9540", name: "IRF9540", stock: 80, priceTiers: [{ range: "1+", price: "11.500đ" }], img: "./images/Product/LINH KIỆN BÁN DẪN/MOSFET/IRF9540.png" }, { id: "6N60A", name: "6N60A", stock: 100, priceTiers: [{ range: "1+", price: "14.000đ" }], img: "./images/Product/LINH KIỆN BÁN DẪN/MOSFET/6N60A.jpg" }, { id: "AOD1N60", name: "AOD1N60", stock: 200, priceTiers: [{ range: "1+", price: "8.500đ" }], img: "./images/Product/LINH KIỆN BÁN DẪN/MOSFET/AOD1N60.jpg" }, { id: "W14NK50Z", name: "W14NK50Z", stock: 40, priceTiers: [{ range: "1+", price: "39.000đ" }], img: "./images/Product/LINH KIỆN BÁN DẪN/MOSFET/W14NK50Z.jpg" }, { id: "2SK2369", name: "2SK2369", stock: 300, priceTiers: [{ range: "1+", price: "14.000đ" }], img: "./images/Product/SanPhamNoiBat/2SK2369.jpg" } ] }, { type: "igbt", title: "IGBT", products: [ { id: "FGA25N120", name: "FGA25N120", stock: 90, priceTiers: [{ range: "1+", price: "29.000đ" }], img: "./images/Product/LINH KIỆN BÁN DẪN/IGBT/FGA25N120.jpg" }, { id: "H20R1203", name: "H20R1203", stock: 60, priceTiers: [{ range: "1+", price: "50.000đ" }], img: "./images/Product/LINH KIỆN BÁN DẪN/IGBT/H20R1203.jpg" } ] } ] }, { mainCategoryTitle: "CẢM BIẾN (SENSORS)", subCategories: [ { type: "cam-bien-nhiet-do", title: "Cảm biến nhiệt độ", products: [ { id: "DS18B20", name: "DS18B20", stock: 250, priceTiers: [{ range: "1+", price: "26.000đ" }], img: "./images/Product/CẢM BIẾN (SENSORS)/Cảm biến nhiệt độ/DS18B20.png" } ] }, { type: "cam-bien-pir", title: "Cảm biến chuyển động (PIR)", products: [ { id: "D203B", name: "D203B", stock: 180, priceTiers: [{ range: "1+", price: "25.000đ" }], img: "./images/Product/CẢM BIẾN (SENSORS)/Cảm biến chuyển động/D203B.png" } ] }, { type: "cam-bien-mau-sac", title: "Cảm biến màu sắc", products: [ { id: "TCS230", name: "TTCS230", stock: 75, priceTiers: [{ range: "1+", price: "65.000đ" }], img: "./images/Product/CẢM BIẾN (SENSORS)/Cảm biến màu sắc/TCS230.jpg" } ] } ] }, { mainCategoryTitle: "LINH KIỆN CÔNG SUẤT - NGUỒN", subCategories: [ { type: "ic-nguon", title: "IC Nguồn", products: [ { id: "LM317", name: "LM317", stock: 500, priceTiers: [{ range: "1+", price: "4.000đ" }], img: "./images/Product/LINH KIỆN CÔNG SUẤT - NGUỒN/IC Nguồn/LM317.png" }, { id: "78L05", name: "78L05", stock: 600, priceTiers: [{ range: "1+", price: "5.000đ" }], img: "./images/Product/LINH KIỆN CÔNG SUẤT - NGUỒN/IC Nguồn/78L05.jpg" }, { id: "LM350K", name: "LM350K", stock: 30, priceTiers: [{ range: "1+", price: "60.000đ" }], img: "./images/Product/LINH KIỆN CÔNG SUẤT - NGUỒN/IC Nguồn/LM350K.png" }, { id: "LM2575-0.5BU", name: "LM2575-0.5BU", stock: 100, priceTiers: [{ range: "1+", price: "25.000đ" }], img: "./images/Product/LINH KIỆN CÔNG SUẤT - NGUỒN/IC Nguồn/LM2575-0.5BU.jpg" } ] }, { type: "module-cong-suat", title: "Module Công suất", products: [ { id: "PM50CLA060", name: "PM50CLA060", stock: 10, priceTiers: [{ range: "1+", price: "3.200.000đ" }], img: "./images/Product/LINH KIỆN CÔNG SUẤT - NGUỒN/Module Công suất/PM50CLA060.png" }, { id: "PM200RSA060", name: "PM200RSA060", stock: 5, priceTiers: [{ range: "1+", price: "7.500.000đ" }], img: "./images/Product/LINH KIỆN CÔNG SUẤT - NGUỒN/Module Công suất/PM200RSA060.png" }, { id: "FSBF10CH60B", name: "FSBF10CH60B", stock: 25, priceTiers: [{ range: "1+", price: "800.000đ" }], img: "./images/Product/LINH KIỆN CÔNG SUẤT - NGUỒN/Module Công suất/FSBF10CH60B.png" }, { id: "SKKT26/12D", name: "SKKT26/12D", stock: 45, priceTiers: [{ range: "1+", price: "490.000đ" }], img: "./images/Product/LINH KIỆN CÔNG SUẤT - NGUỒN/Module Công suất/SKKT26_12D.jpg" } ] }, { type: "ics-do-sai", title: "ICs Dò sai", products: [ { id: "TL431", name: "TL431", stock: 1000, priceTiers: [{ range: "1+", price: "3.000đ" }], img: "./images/Product/LINH KIỆN CÔNG SUẤT - NGUỒN/ICs Dò sai/TL431.png" } ] } ] }, { mainCategoryTitle: "BỘ NGUỒN (ADAPTER)", subCategories: [ { type: "adapter", title: "Bộ nguồn (Adapter)", products: [ { id: "Bộ nguồn 5V - 1A", name: "Bộ nguồn 5V - 1A", stock: 50, priceTiers: [{ range: "1+", price: "45.000đ" }], img: "./images/Product/BỘ NGUỒN (ADAPTER) - BIẾN ÁP/Bộ nguồn (Adapter)/Bộ nguồn 5V - 1A.jpg" }, { id: "Bộ nguồn 12V - 1A", name: "Bộ nguồn 12V - 1A", stock: 60, priceTiers: [{ range: "1+", price: "52.000đ" }], img: "./images/Product/BỘ NGUỒN (ADAPTER) - BIẾN ÁP/Bộ nguồn (Adapter)/Bộ nguồn 12V - 1A.jpg" } ] } ] }, { mainCategoryTitle: "ĐIỆN TRỞ (RESISTORS)", subCategories: [ { type: "resistor-0603", title: "Resistors SMD 0603", products: [ { id: "1Ω - 1% (gói10pcs)", name: "1Ω - 1% (gói10pcs)", stock: 200, priceTiers: [{ range: "1+", price: "1.200đ" }], img: "./images/Product/ĐIỆN TRỞ (RESISTORS)/Resistors SMD 0603/1Ω.png" }, { id: "1Ω -5% (gói10pcs)", name: "1Ω -5% (gói10pcs)", stock: 500, priceTiers: [{ range: "1+", price: "1.000đ" }], img: "./images/Product/ĐIỆN TRỞ (RESISTORS)/Resistors SMD 0603/1Ω.png" } ] }, { type: "resistor-3w", title: "Điện trở 3W", products: [ { id: "1Ω", name: "1Ω", stock: 1000, priceTiers: [{ range: "1+", price: "50đ" }], img: "./images/Product/ĐIỆN TRỞ (RESISTORS)/Điện trở 3W/1Ω.jpg" } ] }, { type: "resistor-thanh", title: "Điện trở thanh", products: [ { id: "Điện trở thanh 1K", name: "Điện trở thanh 1K", stock: 300, priceTiers: [{ range: "1+", price: "2.000đ" }], img: "./images/Product/ĐIỆN TRỞ (RESISTORS)/Điện trở thanh/Điện trở thanh 1K.png" } ] } ] }, { mainCategoryTitle: "TỤ ĐIỆN (CAPACITORS)", subCategories: [ { type: "tu-dien", title: "Tụ điện", products: [ { id: "472-1KV", name: "472-1KV", stock: 400, priceTiers: [{ range: "1+", price: "250đ" }], img: "./images/Product/TỤ ĐIỆN (CAPACITORS)/Tụ điện/472-1KV.jpg" }, { id: "Tụ hóa 1µF/16V", name: "Tụ hóa 1µF/16V", stock: 800, priceTiers: [{ range: "1+", price: "300đ" }], img: "./images/Product/TỤ ĐIỆN (CAPACITORS)/Tụ điện/Tụ hóa 1µF_16V.jpg" } ] }, { type: "tu-dien-smd", title: "Tụ điện SMD (dán)", products: [ { id: "tụ Aluminum 100uF/16V", name: "tụ Aluminum 100uF/16V", stock: 350, priceTiers: [{ range: "1+", price: "1.500đ" }], img: "./images/Product/TỤ ĐIỆN (CAPACITORS)/Tụ điện SMD (dán)/tụ Aluminum 100uF_16V.png" } ] }, { type: "nichicon", title: "Thương hiệu Nichicon", products: [ { id: "Tụ 47uF 16V", name: "Tụ 47uF 16V", stock: 150, priceTiers: [{ range: "1+", price: "2.000đ" }], img: "./images/Product/TỤ ĐIỆN (CAPACITORS)/Thương hiệu Nichicon/Tụ 47uF 16V.jpg" } ] } ] }, { mainCategoryTitle: "LINH KIỆN KẾT NỐI", subCategories: [ { type: "ket-noi", title: "Linh kiện kết nối", products: [ { id: "HR911105A", name: "HR911105A", stock: 100, priceTiers: [{ range: "1+", price: "15.000đ" }], img: "./images/Product/SanPhamNoiBat/HR911105A.jpg" } ] } ] }, { mainCategoryTitle: "IC CHỨC NĂNG", subCategories: [ { type: "ic-chuc-nang", title: "IC chức năng", products: [ { id: "DAC0832LCN", name: "DAC0832LCN", stock: 80, priceTiers: [{ range: "1+", price: "29.000đ" }], img: "./images/Product/SanPhamNoiBat/DAC0832LCN.jpg" } ] } ] }];
        
        const parsePrice = (s) => (s && typeof s === 'string' ? parseInt(s.replace(/[\.đ₫,]/g, '')) : 0);
        
        const allFlatProducts = productCatalog.flatMap(mc => 
            mc.subCategories.flatMap(sc => 
                sc.products.map(p => ({ 
                    ...p, 
                    price: parsePrice(p.priceTiers[0].price), 
                    category: sc.title, 
                    type: sc.type 
                }))
            )
        );

        function addToCart(product) {
            const user = JSON.parse(localStorage.getItem('loggedInUser'));
            if (!user) return;
            const userCartKey = `cart_${user.email}`;
            let cart = JSON.parse(localStorage.getItem(userCartKey)) || [];
            const existingItemIndex = cart.findIndex(item => item.id === product.id && item.type === product.type);
            if (existingItemIndex > -1) {
                cart[existingItemIndex].quantity += 1;
            } else {
                product.quantity = 1;
                cart.push(product);
            }
            localStorage.setItem(userCartKey, JSON.stringify(cart));
            alert(`Đã thêm "${product.name}" vào giỏ hàng!`);
            updateCartIconCount();
        }

        function updateCartIconCount() {
            const user = JSON.parse(localStorage.getItem('loggedInUser'));
            if (!user) {
                const el = document.getElementById('cart-count');
                if(el) el.style.display = 'none';
                return;
            }
            const userCartKey = `cart_${user.email}`;
            const cart = JSON.parse(localStorage.getItem(userCartKey)) || [];
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const cartCountElement = document.getElementById('cart-count');
            if (cartCountElement) {
                cartCountElement.textContent = totalItems;
                cartCountElement.style.display = totalItems > 0 ? 'inline-block' : 'none';
            }
        }

        function setupHeader() {
            const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
            const authSection = document.getElementById('auth-section');
            if (authSection && loggedInUser) {
                 const avatarSrc = loggedInUser.avatar || './images/Other/default-avatar.png';
                 const userMenuHTML = `
                    <div class="relative group py-2">
                      <a href="profile.html" class="flex items-center gap-2 hover:opacity-80 transition">
                        <img src="${avatarSrc}" class="w-8 h-8 rounded-full object-cover border-2 border-gray-500">
                        <span class="font-semibold">${loggedInUser.name}</span>
                        <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                      </a>
                      <div class="absolute right-0 top-full pt-2 -mt-px w-56 bg-transparent hidden group-hover:block z-50">
                        <div class="bg-white text-gray-800 rounded-md shadow-lg border border-gray-200">
                            <div class="px-4 py-3 border-b"><p class="text-sm font-semibold truncate">${loggedInUser.name}</p><p class="text-xs text-gray-500 truncate">${loggedInUser.email}</p></div>
                            <ul class="py-1">
                                <li><a href="profile.html" class="block px-4 py-2 text-sm hover:bg-gray-100">Quản lý tài khoản</a></li>
                                <li><a href="wishlist.html" class="block px-4 py-2 text-sm hover:bg-gray-100">Sản phẩm yêu thích</a></li>
                                <li><a href="my-orders.html" class="block px-4 py-2 text-sm hover:bg-gray-100">Đơn hàng của tôi</a></li>
                            </ul>
                        </div>
                      </div>
                    </div>`;
                 authSection.innerHTML = userMenuHTML + `<button onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md transition text-sm font-semibold">Đăng xuất</button>`;
            }
        }

        window.logout = function() {
            if (confirm('Bạn có chắc chắn muốn đăng xuất?')) {
                localStorage.removeItem('loggedInUser');
                window.location.href = 'index.html'; 
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const user = JSON.parse(localStorage.getItem('loggedInUser'));
            const wishlistGrid = document.getElementById('wishlist-grid');
            const noItemsMessage = document.getElementById('no-items-message');
            
            function renderWishlist() {
                const wishlistKey = `wishlist_${user.email}`;
                const wishlistIds = JSON.parse(localStorage.getItem(wishlistKey)) || [];

                if (wishlistIds.length === 0) {
                    noItemsMessage.classList.remove('hidden');
                    wishlistGrid.innerHTML = '';
                    return;
                }
                
                noItemsMessage.classList.add('hidden');
                const favoriteProducts = allFlatProducts.filter(p => wishlistIds.includes(p.id));

                wishlistGrid.innerHTML = favoriteProducts.map(p => {
                    const productInfoJSON = JSON.stringify({ id: p.id, name: p.name, price: p.priceTiers[0].price, img: p.img, type: p.type });
                    return `
                        <div class="bg-white rounded-xl shadow p-4 flex flex-col">
                            <a href="product-detail.html?id=${p.id}" class="block overflow-hidden rounded-lg mb-4">
                                <img src="${p.img}" alt="${p.name}" class="w-full h-40 object-cover transform hover:scale-110 transition-transform duration-300">
                            </a>
                            <div class="flex-grow">
                                <h3 class="font-semibold text-gray-800">${p.name}</h3>
                                <p class="text-blue-600 font-bold mt-2">${p.price.toLocaleString('vi-VN')}đ</p>
                            </div>
                            <div class="mt-4 flex gap-2">
                                <button onclick='removeFromWishlistAndReload("${p.id}")' class="p-2 bg-red-100 text-red-600 rounded-md hover:bg-red-200" title="Xóa khỏi danh sách yêu thích">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                                </button>
                                <button onclick='addToCart(${productInfoJSON})' class="flex-1 bg-blue-600 text-white text-sm text-center py-2 rounded-md hover:bg-blue-700">Thêm vào giỏ</button>
                            </div>
                        </div>`;
                }).join('');
            }

            window.removeFromWishlistAndReload = (productId) => {
                if (!confirm('Bạn có chắc muốn xóa sản phẩm này khỏi danh sách yêu thích?')) return;
                const wishlistKey = `wishlist_${user.email}`;
                let wishlist = JSON.parse(localStorage.getItem(wishlistKey)) || [];
                const updatedWishlist = wishlist.filter(id => id !== productId);
                localStorage.setItem(wishlistKey, JSON.stringify(updatedWishlist));
                renderWishlist();
            };

            setupHeader();
            updateCartIconCount();
            renderWishlist();
        });
    </script>
</body>
</html>